#!/bin/sh

# Quick command line voice recorder. Requires alsa-utils for arecord, speex for speexenc

LOCATION="$HOME/doc/notes/recordings"
MYDATE=`date "+%Y%m%d-%H%M%S"`
if [ "$1" = "-nd" ]; then
	shift
	FILENAME=""
else
	FILENAME="$MYDATE "
fi
TITLE="$*"

if [ ! -z "$TITLE" ]; then
	FILENAME="$FILENAME`echo "$TITLE" | cut -c -20`"
fi

FILENAME="$FILENAME.opus"

if [ -f "$FILENAME" ]; then
	echo "$FILENAME exists, refusing to overwrite."
	exit 1
fi

if [ ! -d "$LOCATION" ]; then
	echo "$LOCATION does not exist, please configure directories."
	exit 1
fi

arecord -f S16_LE -c1 -r16000 -t raw | opusenc --raw --raw-rate 16000 --raw-bits 16 --raw-chan 1 --raw-endianness 0 --bitrate 16 - "$LOCATION/$FILENAME"
