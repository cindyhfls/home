#!/bin/sh

usage(){ cat <<- USAGE >&2
	Usage: $0 [-C DIRECTORY] FILENAME

	Look for FILENAME in the current or given DIRECTORY and all of its
	ancestors until found. Return the full path of the closest match on
	standard output.

	Example:

	    Run 'make' from deep within your source heiarchy, like 'ant -find':
	        make -f \`acquire Makefile\`
	USAGE
}

# TODO: implement in other languages.

if [ "$1" = "-C" ]; then
	cwd="$2"
	shift 2
else
	cwd="$(pwd)"
fi
cwd="$(readlink -f "$cwd")"

target="$1"

if [ ! "$1" ]; then
	usage
	exit 1
fi

while [ "$cwd" ]; do
	if [ -e "$cwd/$target" ]; then
		[ "$cwd" = "/" ] && echo "/$1" || echo "$cwd/$1"
		exit 0
	fi
	cwd="${cwd%/*}"
done
 
exit 1
